<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.teams.mapper.ProductSjMapper">

  
  <!--查询审核通过的产品信息  -->
  <select id="selectProduct" resultType="D_file">
			SELECT a.product_id,a.product_name,a.list_price,
			a.factory_name,a.amount_unit,a.delete_tag,
			b.tname,c.pname FROM D_FILE a,TYPE b,pclass c
			WHERE b.`tid`=a.`tid` 
			AND c.`pid`=a.`pid`
			AND CHECK_TAG=#{CHECK_TAG}
  </select>
  
  <!--删除和恢复审核通过的产品信息 -->
  <update id="updDelete_tag">
            update d_file set delete_tag =#{delete_tag} 
            where product_id =#{product_id}
  </update>
  
  <!--永久删除审核通过的产品信息 -->
  <delete id="yjDeleteProduct">
            delete from d_file where product_id =#{product_id}
  </delete>

   <!-- 产品档案等待审核查询 -->     
     <select id="selectcpdash" resultType="D_file">
        select a.*,b.fname,c.tname,d.pname from d_file a,feilei b,type c,pclass d
        where a.fid=b.fid and 
        a.tid=c.tid and 
        a.pid=d.pid and  
        a.check_tag=#{check_tag}
     </select>
     
     <!-- 产品类型查询 -->
     <select id="selecttype" resultType="Type">
        select * from type
     </select>
     
     <!-- 产品档次查询 -->
     <select id="selectpclass" resultType="Pclass">
        select * from pclass
     </select>
     
     <!-- 产品档案审核 -->
     <update id="updfh">
        update d_file set product_name=#{product_name},factory_name=#{factory_name},
        product_nick=#{product_nick},tid=#{tid},pid=#{pid},personal_unit=#{personal_unit},
        personal_value=#{personal_value},provider_group=#{provider_group},list_price=#{list_price},
        cost_price=#{cost_price},amount_unit=#{amount_unit},warranty=#{warranty},twin_name=#{twin_name},
        twin_id=#{twin_id},lifecycle=#{lifecycle},responsible_person=#{responsible_person},register=#{register},
        check_tag=#{check_tag},checker=#{checker},check_time=now() 
        where product_id=#{product_id}
     </update>
     
     <!-- 查询等待复核总数 -->
     <select id="selectddfh" resultType="int">
        SELECT count(1) from d_file where check_tag=#{check_tag}
     </select>
     
     <!-- 查询通过复核总数 -->
     <select id="selecttgfh" resultType="int">
        SELECT count(1) from d_file where check_tag=#{check_tag}
     </select>

     <!-- 产品物料设计单审核查询 -->
     <select id="selectwusjsh" resultType="D_module">
        select * from D_module where check_tag=#{check_tag}
     </select>
     
     <!-- 查询产品物料设计单等待审核总数 -->
     <select id="selectwuddshsum" resultType="int">
        SELECT count(1) from D_module where check_tag=#{check_tag}
     </select>
     
     <!-- 查询产品设计单物料明细 -->
     <select id="selectwlmx" resultType="D_module_details">
        select * from D_module_details where design_id=#{design_id}
     </select>
     
     <!-- 物料组成设计通过 -->
     <update id="updatewlsh">
        update D_module set module_describe=#{module_describe},checker=#{checker},check_time=now(),check_tag=#{check_tag}
        where design_id=#{design_id}
     </update>
     
     <!-- 物料组成设计不通过 -->
     <delete id="delwlsjmx">
        delete from D_module_details where design_id=#{String design_id}
     </delete>
     
     <!-- 物料组成设计不通过 -->
     <update id="updcpdnwlsj">
        update d_file set design_module_tag=#{design_module_tag} where product_id=#{product_id}
     </update>
     
     <!-- 物料组成设计不通过 -->
     <delete id="delwlsj">
        delete from D_module where design_id=#{design_id}
     </delete>
     
  </mapper>